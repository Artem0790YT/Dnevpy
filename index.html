<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–î–Ω–µ–≤–Ω–∏–∫.—Ä—É ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è (Full / Lite)</title>

<!-- -------------------------
     –°–¢–ò–õ–ò. –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è + —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è
     ------------------------- -->
<style>
  :root{
    --accent1: #3498db;
    --accent2: #6a11cb;
    --accent3: #2575fc;
    --good: #2ecc71;
    --bad: #e74c3c;
    --bg: #f5f7fb;
    --text: #222;
  }
  html,body{height:100%;margin:0;font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;color:var(--text);background:var(--bg);}

  /* ---------- —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –≤–µ—Ä—Å–∏–∏ ---------- */
  #startScreen{
    min-height:100vh;
    display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:24px;
    background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.95));
  }
  #startScreen h1{font-size:28px;margin-bottom:6px;}
  #startScreen p{margin:8px 0 20px;color:#555;}
  .chooseBtns{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
  .btn{
    padding:10px 18px;border-radius:8px;border:none;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(0,0,0,0.08);
  }
  .btn-full{background:linear-gradient(135deg,var(--accent2),var(--accent3));color:#fff;}
  .btn-lite{background:#fff;border:1px solid #e3e6ea;color:#333;}
  .muted{color:#6b6f76;font-size:14px;margin-top:8px}

  /* ---------- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ---------- */
  .app{display:none;min-height:100vh;}
  header.app-header{
    display:flex;align-items:center;justify-content:space-between;padding:12px 20px;color:#fff;
    background:linear-gradient(135deg,var(--accent2),var(--accent3));
  }
  header.app-header .left{display:flex;align-items:center;gap:12px}
  header.app-header .logo{font-weight:700;font-size:18px}
  header.app-header .controls{display:flex;gap:8px;align-items:center}
  .switch-btn{background:#fff;color:#333;padding:6px 10px;border-radius:6px;border:none;cursor:pointer}
  .container{max-width:1200px;margin:20px auto;padding:0 18px}

  /* ---------- –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è (rich) ---------- */
  .full .top-row{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
  .card{background:#ffffff;border-radius:10px;padding:18px;box-shadow:0 6px 20px rgba(21,29,41,0.06);margin-bottom:18px}
  .card h2{margin:0 0 10px;font-size:18px;color:#263238}
  .nav-tabs{display:flex;gap:8px;margin:12px 0 18px;flex-wrap:wrap}
  .nav-tabs .tab{padding:10px 14px;border-radius:8px;background:linear-gradient(180deg,#fff,#f8fbff);cursor:pointer;border:1px solid #e8eef8}
  .nav-tabs .tab.active{border-color:var(--accent1);box-shadow:0 6px 20px rgba(52,152,219,0.12);color:var(--accent1);font-weight:700}
  .controls-row{display:flex;gap:10px;align-items:center}
  .user-info{display:flex;gap:10px;align-items:center;color:#fff}
  .user-info img{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.15)}
  .btn-action{background:var(--accent1);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
  .btn-danger{background:var(--bad);color:#fff}

  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #f1f4f8;text-align:left}
  th{background:#fbfdff;font-weight:700;color:#3b4a56}

  .grade{display:inline-block;padding:6px 10px;border-radius:999px;color:#fff;font-weight:700}
  .grade.excellent{background:var(--good)}
  .grade.good{background:var(--accent1)}
  .grade.satisfactory{background:#f39c12}
  .grade.bad{background:var(--bad)}

  .homework-item{padding:12px;border-left:6px solid var(--accent1);background:#fbfdff;margin-bottom:12px;border-radius:6px}
  .homework-date{color:#6e767d;font-size:13px;margin-top:6px}

  /* –º–æ–¥–∞–ª–∫–∏ –ø—Ä–æ—Å—Ç–æ–π —Å—Ç–∏–ª—å */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:9999}
  .modal .modal-content{background:#fff;padding:18px;border-radius:10px;max-width:520px;width:100%}
  .modal .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .modal label{display:block;margin:8px 0 6px;font-weight:600}
  .form-group input, .form-group select, .form-group textarea{width:100%;padding:10px;border:1px solid #e6edf3;border-radius:8px;font-size:14px}

  /* ---------- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è (lite) –≤–µ—Ä—Å–∏—è ---------- */
  .lite header.app-header{background:#333}
  .lite .container{padding:10px}
  .lite .card{background:transparent;box-shadow:none;padding:6px;border-radius:0}
  .lite table{border:1px solid #ddd}
  .lite th, .lite td{padding:8px;font-size:14px}
  .lite .smallmuted{color:#666;font-size:13px}

  /* –∞–¥–∞–ø—Ç–∏–≤ */
  @media (max-width:768px){
    .nav-tabs{overflow:auto;padding-bottom:8px}
    header.app-header{flex-direction:column;align-items:flex-start;gap:8px;padding:12px}
  }
</style>
</head>
<body>

<!-- ================= START: Start screen (choose version) ================= -->
<div id="startScreen">
  <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –î–Ω–µ–≤–Ω–∏–∫.—Ä—É</h1>
  <p id="recommendText">–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî –ø–æ–ª–Ω–∞—è –∏–ª–∏ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π).</p>
  <div class="chooseBtns">
    <button class="btn btn-full" onclick="startApp('full')">–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</button>
    <button class="btn btn-lite" onclick="startApp('lite')">–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</button>
  </div>
  <div class="muted">–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ —à–∞–ø–∫–µ.</div>
</div>
<!-- ================= END: Start screen ================= -->

<!-- ================= START: Full app ================= -->
<div id="fullApp" class="app full" aria-hidden="true">
  <header class="app-header">
    <div class="left">
      <div class="logo"><i class="fa-book" aria-hidden="true"></i> –î–Ω–µ–≤–Ω–∏–∫.—Ä—É ‚Äî –ü–æ–ª–Ω–∞—è</div>
    </div>

    <div class="controls">
      <div class="user-info">
        <img id="fullAvatar" src="https://ui-avatars.com/api/?name=User&background=3498db&color=fff" alt="User">
        <div style="color:#fff;text-align:right">
          <div id="fullUserName">–ì–æ—Å—Ç—å</div>
          <div id="fullUserRole" style="font-size:13px;opacity:0.9">–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
        </div>
      </div>
      <button class="switch-btn" onclick="switchVersion('lite')">–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</button>
      <button class="switch-btn" id="openStart" onclick="openStart()">‚Ü∫ –í—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏</button>
    </div>
  </header>

  <div class="container">
    <!-- login card -->
    <div id="fullLoginCard" class="card" style="max-width:480px;margin:10px auto;">
      <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
      <div class="form-group">
        <label>–õ–æ–≥–∏–Ω</label>
        <input id="fullLogin" type="text" placeholder="–õ–æ–≥–∏–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä student)">
      </div>
      <div class="form-group">
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input id="fullPassword" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
      </div>
      <div class="form-group">
        <label>–¢–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
        <select id="fullUserType">
          <option value="student">–£—á–µ–Ω–∏–∫</option>
          <option value="teacher">–£—á–∏—Ç–µ–ª—å</option>
          <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
        </select>
      </div>
      <div style="display:flex;gap:10px;margin-top:8px">
        <button class="btn-action" onclick="fullLogin()">–í–æ–π—Ç–∏</button>
        <button class="btn-action" style="background:#7f8c8d" onclick="demoLogin()">–î–µ–º–æ (student)</button>
      </div>
      <div id="fullLoginMsg" style="margin-top:10px;color:#c0392b"></div>
    </div>

    <!-- –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div id="fullMain" style="display:none">
      <div class="nav-tabs" id="fullTabs">
        <div class="tab active" data-tab="schedule" onclick="fullSwitchTab(event)">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
        <div class="tab" data-tab="homework" onclick="fullSwitchTab(event)">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</div>
        <div class="tab" data-tab="grades" onclick="fullSwitchTab(event)">–û—Ü–µ–Ω–∫–∏</div>
        <div class="tab" data-tab="students" onclick="fullSwitchTab(event)">–£—á–µ–Ω–∏–∫–∏</div>
        <div class="tab" data-tab="teachers" onclick="fullSwitchTab(event)">–£—á–∏—Ç–µ–ª—è</div>
      </div>

      <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
      <div id="full_schedule_tab" class="card tab-content active">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é</h2>
          <div>
            <button class="btn-action" onclick="openModal('addScheduleModal')">–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</button>
            <button class="btn-action" style="background:#95a5a6" onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
          </div>
        </div>
        <div id="fullScheduleContent" style="margin-top:12px"></div>
      </div>

      <!-- –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è -->
      <div id="full_homework_tab" class="card tab-content" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
          <button class="btn-action" onclick="openModal('addHomeworkModal')">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
        </div>
        <div id="fullHomeworkContent" style="margin-top:12px"></div>
      </div>

      <!-- –û—Ü–µ–Ω–∫–∏ -->
      <div id="full_grades_tab" class="card tab-content" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>–û—Ü–µ–Ω–∫–∏</h2>
          <button class="btn-action" onclick="openModal('addGradeModal')">–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
        </div>
        <div id="fullGradesContent" style="margin-top:12px"></div>
      </div>

      <!-- –£—á–µ–Ω–∏–∫–∏ -->
      <div id="full_students_tab" class="card tab-content" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>–£—á–µ–Ω–∏–∫–∏</h2>
          <button class="btn-action" onclick="openModal('addStudentModal')">–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
        </div>
        <div id="fullStudentsContent" style="margin-top:12px"></div>
      </div>

      <!-- –£—á–∏—Ç–µ–ª—è -->
      <div id="full_teachers_tab" class="card tab-content" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>–£—á–∏—Ç–µ–ª—è</h2>
          <button class="btn-action" onclick="openModal('addTeacherModal')">–î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è</button>
        </div>
        <div id="fullTeachersContent" style="margin-top:12px"></div>
      </div>
    </div>
  </div>
</div>
<!-- ================= END: Full app ================= -->

<!-- ================= START: Lite app ================= -->
<div id="liteApp" class="app lite" aria-hidden="true">
  <header class="app-header">
    <div class="logo">–î–Ω–µ–≤–Ω–∏–∫.—Ä—É ‚Äî –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è</div>
    <div class="controls">
      <button class="switch-btn" onclick="switchVersion('full')">–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</button>
      <button class="switch-btn" onclick="openStart()">‚Ü∫ –í—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏</button>
    </div>
  </header>

  <div class="container">
    <!-- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ø—Ä–æ—Å—Ç–æ–π –≤–≤–æ–¥) -->
    <div class="card" id="liteLoginCard" style="max-width:720px;margin:8px auto">
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="liteLogin" placeholder="–õ–æ–≥–∏–Ω" style="padding:8px;border:1px solid #ddd;border-radius:6px">
        <input id="litePassword" placeholder="–ü–∞—Ä–æ–ª—å" type="password" style="padding:8px;border:1px solid #ddd;border-radius:6px">
        <select id="liteUserType" style="padding:8px;border:1px solid #ddd;border-radius:6px">
          <option value="student">–£—á–µ–Ω–∏–∫</option><option value="teacher">–£—á–∏—Ç–µ–ª—å</option><option value="admin">–ê–¥–º–∏–Ω</option>
        </select>
        <button class="btn-action" onclick="liteLogin()">–í–æ–π—Ç–∏</button>
        <button class="btn-action" style="background:#95a5a6" onclick="demoLogin('lite')">–î–µ–º–æ</button>
      </div>
      <div id="liteLoginMsg" class="smallmuted" style="margin-top:8px"></div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç lite -->
    <div id="liteMain" style="display:none">
      <div class="card">
        <h2>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–ª–µ–Ω–∏–≤–æ)</h2>
        <div id="liteSchedule"></div>
      </div>

      <div class="card">
        <h2>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
        <table>
          <thead><tr><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–°—Ä–æ–∫</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr></thead>
          <tbody id="liteHomework"></tbody>
        </table>
      </div>

      <div class="card">
        <h2>–û—Ü–µ–Ω–∫–∏</h2>
        <table>
          <thead><tr><th>–£—á–µ–Ω–∏–∫</th><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–û—Ü–µ–Ω–∫–∏</th></tr></thead>
          <tbody id="liteGrades"></tbody>
        </table>
      </div>

      <div class="card">
        <h2>–£—á–µ–Ω–∏–∫–æ–≤ ‚Äî <span id="liteStudentsCount">0</span></h2>
        <div id="liteStudentsList" class="smallmuted"></div>
      </div>

      <div class="card">
        <h2>–£—á–∏—Ç–µ–ª–µ–π</h2>
        <div id="liteTeachersList" class="smallmuted"></div>
      </div>
    </div>
  </div>
</div>
<!-- ================= END: Lite app ================= -->

<!-- ================= START: Modals (shared) ================= -->
<!-- Add Schedule -->
<div id="addScheduleModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫</h3>
      <button onclick="closeModal('addScheduleModal')">‚úï</button>
    </div>
    <div>
      <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏</label>
      <select id="ms_day">
        <option value="monday">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
        <option value="tuesday">–í—Ç–æ—Ä–Ω–∏–∫</option>
        <option value="wednesday">–°—Ä–µ–¥–∞</option>
        <option value="thursday">–ß–µ—Ç–≤–µ—Ä–≥</option>
        <option value="friday">–ü—è—Ç–Ω–∏—Ü–∞</option>
        <option value="saturday">–°—É–±–±–æ—Ç–∞</option>
      </select>

      <label>–í—Ä–µ–º—è</label>
      <input id="ms_time" placeholder="08:30-09:15">

      <label>–ü—Ä–µ–¥–º–µ—Ç</label>
      <input id="ms_subject">

      <label>–ö–∞–±–∏–Ω–µ—Ç</label>
      <input id="ms_room">

      <label>–£—á–∏—Ç–µ–ª—å</label>
      <input id="ms_teacher">

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-action" onclick="saveScheduleModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn-danger" onclick="closeModal('addScheduleModal')">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Homework -->
<div id="addHomeworkModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h3>
      <button onclick="closeModal('addHomeworkModal')">‚úï</button>
    </div>
    <div>
      <label>–ü—Ä–µ–¥–º–µ—Ç</label>
      <select id="mh_subject">
        <option value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option>
        <option value="–†—É—Å—Å–∫–∏–π —è–∑—ã–∫">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</option>
        <option value="–§–∏–∑–∏–∫–∞">–§–∏–∑–∏–∫–∞</option>
        <option value="–ò—Å—Ç–æ—Ä–∏—è">–ò—Å—Ç–æ—Ä–∏—è</option>
      </select>

      <label>–°—Ä–æ–∫</label>
      <input id="mh_deadline" type="date">

      <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
      <textarea id="mh_text" rows="4"></textarea>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-action" onclick="saveHomeworkModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn-danger" onclick="closeModal('addHomeworkModal')">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Grade -->
<div id="addGradeModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</h3>
      <button onclick="closeModal('addGradeModal')">‚úï</button>
    </div>
    <div>
      <label>–£—á–µ–Ω–∏–∫</label>
      <select id="mg_student"></select>

      <label>–ü—Ä–µ–¥–º–µ—Ç</label>
      <select id="mg_subject">
        <option value="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</option>
        <option value="–†—É—Å—Å–∫–∏–π —è–∑—ã–∫">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</option>
        <option value="–§–∏–∑–∏–∫–∞">–§–∏–∑–∏–∫–∞</option>
      </select>

      <label>–û—Ü–µ–Ω–∫–∞</label>
      <select id="mg_value">
        <option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option>
      </select>

      <label>–î–∞—Ç–∞</label>
      <input id="mg_date" type="date" value="">

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-action" onclick="saveGradeModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn-danger" onclick="closeModal('addGradeModal')">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Student -->
<div id="addStudentModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h3>
      <button onclick="closeModal('addStudentModal')">‚úï</button>
    </div>
    <div>
      <label>–§–ò–û</label>
      <input id="ms_name">

      <label>–ö–ª–∞—Å—Å</label>
      <input id="ms_class">

      <label>–õ–æ–≥–∏–Ω</label>
      <input id="ms_login">

      <label>–ü–∞—Ä–æ–ª—å</label>
      <input id="ms_pass">

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-action" onclick="saveStudentModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn-danger" onclick="closeModal('addStudentModal')">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Teacher -->
<div id="addTeacherModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è</h3>
      <button onclick="closeModal('addTeacherModal')">‚úï</button>
    </div>
    <div>
      <label>–§–ò–û</label>
      <input id="mt_name">

      <label>–ü—Ä–µ–¥–º–µ—Ç</label>
      <input id="mt_subject">

      <label>–õ–æ–≥–∏–Ω</label>
      <input id="mt_login">

      <label>–ü–∞—Ä–æ–ª—å</label>
      <input id="mt_pass">

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn-action" onclick="saveTeacherModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn-danger" onclick="closeModal('addTeacherModal')">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>
<!-- ================= END: Modals ================= -->

<!-- ================= START: –°–∫—Ä–∏–ø—Ç—ã (–ª–æ–≥–∏–∫–∞) ================= -->
<script>
/*
  –ü–æ–ª–Ω—ã–π JS: —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω, –≤—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, data in localStorage,
  —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–ª—è full –∏ lite, –º–æ–¥–∞–ª–∫–∏, CRUD (–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)
*/

/* ------------------ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ —É —Ç–µ–±—è –±—ã–ª–æ) ------------------ */
const initialData = {
  users: [
    { id: 1, login: "student", password: "student123", type: "student", name: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", class: "8–ê" },
    { id: 2, login: "teacher", password: "teacher123", type: "teacher", name: "–ü–µ—Ç—Ä–æ–≤–∞ –ê.–ò.", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" },
    { id: 3, login: "admin", password: "admin123", type: "admin", name: "–°–∏–¥–æ—Ä–æ–≤ –í.–ü." }
  ],
  schedule: [
    { id: 1, day: "monday", time: "08:30-09:15", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", room: "205", teacher: "–ü–µ—Ç—Ä–æ–≤–∞ –ê.–ò." },
    { id: 2, day: "monday", time: "09:25-10:10", subject: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", room: "112", teacher: "–ò–≤–∞–Ω–æ–≤–∞ –ú.–°." },
    { id: 3, day: "tuesday", time: "08:30-09:15", subject: "–§–∏–∑–∏–∫–∞", room: "301", teacher: "–°–∏–¥–æ—Ä–æ–≤ –í.–ü." }
  ],
  homework: [
    { id: 1, subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", assigned: "12.04.2023", deadline: "17.04.2023", description: "–£—á–µ–±–Ω–∏–∫: —Å—Ç—Ä. 145, ‚Ññ 345-348, 350. –†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–æ—Ä–µ–º—ã –ü–∏—Ñ–∞–≥–æ—Ä–∞." },
    { id: 2, subject: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", assigned: "13.04.2023", deadline: "18.04.2023", description: "–£—á–µ–±–Ω–∏–∫: —Å—Ç—Ä. 89-90, —É–ø—Ä. 234. –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å –ø—Ä–∏—á–∞—Å—Ç–Ω—ã–º–∏ –∏ –¥–µ–µ–ø—Ä–∏—á–∞—Å—Ç–Ω—ã–º–∏ –æ–±–æ—Ä–æ—Ç–∞–º–∏." }
  ],
  grades: [
    { id: 1, student: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", value: 5, date: "10.04.2023" },
    { id: 2, student: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", value: 4, date: "12.04.2023" },
    { id: 3, student: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", subject: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", value: 4, date: "11.04.2023" },
    { id: 4, student: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", subject: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", value: 3, date: "13.04.2023" }
  ],
  students: [
    { id: 1, name: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", class: "8–ê", login: "student1", password: "pass1" },
    { id: 2, name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", class: "8–ê", login: "student2", password: "pass2" },
    { id: 3, name: "–°–∏–¥–æ—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π", class: "8–ë", login: "student3", password: "pass3" }
  ],
  teachers: [
    { id: 1, name: "–ü–µ—Ç—Ä–æ–≤–∞ –ê–Ω–Ω–∞ –ò–≤–∞–Ω–æ–≤–Ω–∞", subject: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", login: "teacher1", password: "pass1" },
    { id: 2, name: "–ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞", subject: "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫", login: "teacher2", password: "pass2" },
    { id: 3, name: "–°–∏–¥–æ—Ä–æ–≤ –í–∞—Å–∏–ª–∏–π –ü–µ—Ç—Ä–æ–≤–∏—á", subject: "–§–∏–∑–∏–∫–∞", login: "teacher3", password: "pass3" }
  ]
};

function initializeData(){
  if(!localStorage.getItem('diaryData')){
    localStorage.setItem('diaryData', JSON.stringify(initialData));
  }
  return JSON.parse(localStorage.getItem('diaryData'));
}
function getData(){ return JSON.parse(localStorage.getItem('diaryData')); }
function saveData(d){ localStorage.setItem('diaryData', JSON.stringify(d)); }

let diaryData = initializeData();
let currentUser = null;

/* ------------------ –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω: —Å–æ–≤–µ—Ç –¥–ª—è 2G ------------------ */
(function recommendVersion(){
  const rec = document.getElementById('recommendText');
  let recommended = '';
  // navigator.connection may not be supported everywhere
  try {
    const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    if(conn && conn.effectiveType){
      if(conn.effectiveType.includes('2g')) recommended = '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–µ—Ç—å (2G). –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —É–ø—Ä–æ—â—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.';
      else if(conn.effectiveType.includes('3g')) recommended = '–°–µ—Ç—å 3G ‚Äî –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ª—é–±—É—é –≤–µ—Ä—Å–∏—é, –Ω–æ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ.';
    }
  } catch(e){}
  if(recommended) rec.textContent = recommended;
})();

/* ------------------ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–æ–∫–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ------------------ */
function startApp(mode){
  document.getElementById('startScreen').style.display = 'none';
  if(mode === 'full'){
    showFull();
  } else {
    showLite();
  }
}
function openStart(){
  // –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≤—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏
  document.getElementById('startScreen').style.display = 'flex';
  hideAllApps();
}
function hideAllApps(){
  document.getElementById('fullApp').style.display = 'none';
  document.getElementById('liteApp').style.display = 'none';
}
function switchVersion(mode){
  // –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö/—Å–æ—Å—Ç–æ—è–Ω–∏—è
  if(mode === 'full') showFull();
  else showLite();
}

/* ------------------ Show Full ------------------ */
function showFull(){
  hideAllApps();
  document.getElementById('fullApp').style.display = 'block';
  document.getElementById('fullApp').setAttribute('aria-hidden','false');
  // show login or main
  updateFullUserDisplay();
  if(currentUser) {
    document.getElementById('fullLoginCard').style.display = 'none';
    document.getElementById('fullMain').style.display = 'block';
    loadFullAll();
  } else {
    document.getElementById('fullLoginCard').style.display = 'block';
    document.getElementById('fullMain').style.display = 'none';
  }
}

/* ------------------ Show Lite ------------------ */
function showLite(){
  hideAllApps();
  document.getElementById('liteApp').style.display = 'block';
  document.getElementById('liteApp').setAttribute('aria-hidden','false');
  updateLiteUserDisplay();
  if(currentUser) {
    document.getElementById('liteMain').style.display = 'block';
    loadLiteAll();
    document.getElementById('liteLoginCard').style.display = 'none';
  } else {
    document.getElementById('liteMain').style.display = 'none';
    document.getElementById('liteLoginCard').style.display = 'block';
  }
}

/* ------------------ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (full & lite) ------------------ */
function fullLogin(){
  const u = document.getElementById('fullLogin').value.trim();
  const p = document.getElementById('fullPassword').value;
  const type = document.getElementById('fullUserType').value;
  const found = diaryData.users.find(x => x.login === u && x.password === p && x.type === type);
  if(found){
    currentUser = found;
    document.getElementById('fullLoginMsg').textContent = '';
    updateFullUserDisplay();
    // show main
    document.getElementById('fullLoginCard').style.display = 'none';
    document.getElementById('fullMain').style.display = 'block';
    loadFullAll();
    // also update lite view
    updateLiteUserDisplay();
  } else {
    document.getElementById('fullLoginMsg').textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å/—Ç–∏–ø';
  }
}
function liteLogin(){
  const u = document.getElementById('liteLogin').value.trim();
  const p = document.getElementById('litePassword').value;
  const type = document.getElementById('liteUserType').value;
  const found = diaryData.users.find(x => x.login === u && x.password === p && x.type === type);
  if(found){
    currentUser = found;
    document.getElementById('liteLoginMsg').textContent = '';
    updateLiteUserDisplay();
    document.getElementById('liteLoginCard').style.display = 'none';
    document.getElementById('liteMain').style.display = 'block';
    loadLiteAll();
    // also update full
    updateFullUserDisplay();
  } else {
    document.getElementById('liteLoginMsg').textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å/—Ç–∏–ø';
  }
}
function demoLogin(target){
  // quick demo: login as default student (from initialData)
  currentUser = diaryData.users.find(u => u.type === 'student') || diaryData.users[0];
  updateFullUserDisplay();
  updateLiteUserDisplay();
  if(target === 'lite') {
    document.getElementById('liteLoginCard').style.display = 'none';
    document.getElementById('liteMain').style.display = 'block';
    loadLiteAll();
    showLite();
  } else {
    document.getElementById('fullLoginCard').style.display = 'none';
    document.getElementById('fullMain').style.display = 'block';
    loadFullAll();
    showFull();
  }
}
function updateFullUserDisplay(){
  if(currentUser){
    document.getElementById('fullUserName').textContent = currentUser.name || currentUser.login;
    let role = currentUser.type === 'student' ? `–£—á–µ–Ω–∏–∫ ${currentUser.class || ''}` : (currentUser.type === 'teacher' ? `–£—á–∏—Ç–µ–ª—å ${currentUser.subject || ''}` : '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä');
    document.getElementById('fullUserRole').textContent = role;
    document.getElementById('fullAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name || currentUser.login)}&background=3498db&color=fff`;
  } else {
    document.getElementById('fullUserName').textContent = '–ì–æ—Å—Ç—å';
    document.getElementById('fullUserRole').textContent = '–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
    document.getElementById('fullAvatar').src = `https://ui-avatars.com/api/?name=Guest&background=777&color=fff`;
  }
}
function updateLiteUserDisplay(){
  // lightweight: show small hint in lite login area
  const msg = document.getElementById('liteLoginMsg');
  if(currentUser) msg.textContent = `–í–æ—à—ë–ª: ${currentUser.name || currentUser.login} (${currentUser.type})`;
  else msg.textContent = '–í—ã –Ω–µ –≤–æ—à–ª–∏. –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.';
}

/* ------------------ Full tabs switching ------------------ */
function fullSwitchTab(e){
  const clicked = e.currentTarget;
  // tabs visuals
  document.querySelectorAll('#fullTabs .tab').forEach(t => t.classList.remove('active'));
  clicked.classList.add('active');
  // change content
  const tabName = clicked.getAttribute('data-tab');
  ['schedule','homework','grades','students','teachers'].forEach(t => {
    const el = document.getElementById(`full_${t}_tab`);
    if(el) el.style.display = (t === tabName ? 'block' : 'none');
  });
}

/* ------------------ CRUD: Schedule ------------------ */
function loadScheduleForFull(){
  const scheduleContent = document.getElementById('fullScheduleContent');
  scheduleContent.innerHTML = '';
  const days = { monday:'–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', tuesday:'–í—Ç–æ—Ä–Ω–∏–∫', wednesday:'–°—Ä–µ–¥–∞', thursday:'–ß–µ—Ç–≤–µ—Ä–≥', friday:'–ü—è—Ç–Ω–∏—Ü–∞', saturday:'–°—É–±–±–æ—Ç–∞' };
  Object.keys(days).forEach(dayKey => {
    const dayLessons = diaryData.schedule.filter(l => l.day === dayKey);
    if(dayLessons.length === 0) return;
    const dayWrap = document.createElement('div');
    dayWrap.innerHTML = `<div style="font-weight:700;margin-bottom:8px;color:#2b3a4a">${days[dayKey]}</div>`;
    const table = document.createElement('table');
    table.innerHTML = `<thead><tr><th>–í—Ä–µ–º—è</th><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–ö–∞–±–∏–Ω–µ—Ç</th><th>–£—á–∏—Ç–µ–ª—å</th>${currentUser && currentUser.type !== 'student' ? '<th>–î–µ–π—Å—Ç–≤–∏—è</th>' : ''}</tr></thead>`;
    const tbody = document.createElement('tbody');
    dayLessons.forEach(lesson => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${lesson.time}</td><td>${lesson.subject}</td><td>${lesson.room}</td><td>${lesson.teacher}</td>`;
      if(currentUser && currentUser.type !== 'student'){
        const td = document.createElement('td');
        td.innerHTML = `<button class="btn-action" onclick="editSchedule(${lesson.id})" style="margin-right:6px">‚úé</button><button class="btn-danger" onclick="deleteSchedule(${lesson.id})">üóëÔ∏è</button>`;
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    dayWrap.appendChild(table);
    scheduleContent.appendChild(dayWrap);
  });
}
function openAddScheduleModal(){ openModal('addScheduleModal'); clearScheduleModal(); }
function clearScheduleModal(){
  document.getElementById('ms_day').value = 'monday';
  document.getElementById('ms_time').value = '';
  document.getElementById('ms_subject').value = '';
  document.getElementById('ms_room').value = '';
  document.getElementById('ms_teacher').value = '';
  document.getElementById('addScheduleModal').dataset.editId = '';
}
function saveScheduleModal(){
  const day = document.getElementById('ms_day').value;
  const time = document.getElementById('ms_time').value.trim();
  const subject = document.getElementById('ms_subject').value.trim();
  const room = document.getElementById('ms_room').value.trim();
  const teacher = document.getElementById('ms_teacher').value.trim();
  if(!time || !subject || !room || !teacher){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  const editId = document.getElementById('addScheduleModal').dataset.editId;
  if(editId){
    diaryData.schedule = diaryData.schedule.map(s => s.id == editId ? {...s, day, time, subject, room, teacher} : s);
  } else {
    const nid = diaryData.schedule.length ? Math.max(...diaryData.schedule.map(s => s.id)) + 1 : 1;
    diaryData.schedule.push({id: nid, day, time, subject, room, teacher});
  }
  saveData(diaryData);
  loadFullAll(); loadLiteAll();
  closeModal('addScheduleModal');
}
function editSchedule(id){
  const lesson = diaryData.schedule.find(l => l.id === id);
  if(!lesson) return;
  document.getElementById('ms_day').value = lesson.day;
  document.getElementById('ms_time').value = lesson.time;
  document.getElementById('ms_subject').value = lesson.subject;
  document.getElementById('ms_room').value = lesson.room;
  document.getElementById('ms_teacher').value = lesson.teacher;
  document.getElementById('addScheduleModal').dataset.editId = id;
  openModal('addScheduleModal');
}
function deleteSchedule(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å —É—Ä–æ–∫?')) return;
  diaryData.schedule = diaryData.schedule.filter(s => s.id !== id);
  saveData(diaryData);
  loadFullAll(); loadLiteAll();
}

/* ------------------ CRUD: Homework ------------------ */
function loadHomeworkForFull(){
  const hw = document.getElementById('fullHomeworkContent');
  hw.innerHTML = '';
  if(diaryData.homework.length === 0){ hw.innerHTML = '<p>–î–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π –Ω–µ—Ç</p>'; return; }
  diaryData.homework.forEach(h => {
    const div = document.createElement('div');
    div.className = 'homework-item';
    div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:start">
      <div><b>${h.subject}</b><div class="homework-date">–ó–∞–¥–∞–Ω–æ: ${h.assigned} | –°—Ä–æ–∫: ${h.deadline}</div></div>
      <div style="text-align:right">${currentUser && currentUser.type !== 'student' ? `<button class="btn-action" onclick="editHomework(${h.id})">‚úé</button> <button class="btn-danger" onclick="deleteHomework(${h.id})">üóë</button>` : ''}</div>
    </div>
    <div style="margin-top:8px">${h.description}</div>`;
    hw.appendChild(div);
  });
}
function saveHomeworkModal(){
  const subject = document.getElementById('mh_subject').value;
  const deadline = document.getElementById('mh_deadline').value;
  const text = document.getElementById('mh_text').value.trim();
  if(!subject || !deadline || !text){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  const newId = diaryData.homework.length ? Math.max(...diaryData.homework.map(h=>h.id))+1 : 1;
  const assigned = new Date().toLocaleDateString('ru-RU');
  diaryData.homework.push({id:newId, subject, assigned, deadline: formatDateForDisplay(deadline), description: text});
  saveData(diaryData);
  loadFullAll(); loadLiteAll();
  closeModal('addHomeworkModal');
}
function editHomework(id){
  const h = diaryData.homework.find(x => x.id === id);
  if(!h) return;
  // prefill
  document.getElementById('mh_subject').value = h.subject;
  // convert dd.mm.yyyy to yyyy-mm-dd if needed
  const dParts = h.deadline.split('.');
  const dd = dParts.length === 3 ? `${dParts[2]}-${dParts[1]}-${dParts[0]}` : '';
  document.getElementById('mh_deadline').value = dd;
  document.getElementById('mh_text').value = h.description;
  // remove old on save by replacing function temporarily (simpler approach: delete first)
  // we'll delete when saving: mark edit id
  document.getElementById('addHomeworkModal').dataset.editId = id;
  openModal('addHomeworkModal');
}
function deleteHomework(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ?')) return;
  diaryData.homework = diaryData.homework.filter(h => h.id !== id);
  saveData(diaryData);
  loadFullAll(); loadLiteAll();
}

/* ------------------ CRUD: Grades ------------------ */
function loadGradesForFull(){
  const el = document.getElementById('fullGradesContent');
  el.innerHTML = '';
  let gradesToShow = diaryData.grades;
  if(currentUser && currentUser.type === 'student') gradesToShow = diaryData.grades.filter(g => g.student === currentUser.name);
  if(gradesToShow.length === 0){ el.innerHTML = '<p>–û—Ü–µ–Ω–æ–∫ –Ω–µ—Ç</p>'; return; }
  // group by subject
  const bySub = {};
  gradesToShow.forEach(g => { bySub[g.subject] = bySub[g.subject] || []; bySub[g.subject].push(g); });
  const table = document.createElement('table');
  table.innerHTML = `<thead><tr><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–û—Ü–µ–Ω–∫–∏</th><th>–°—Ä–µ–¥–Ω–∏–π</th>${currentUser && currentUser.type !== 'student' ? '<th>–î–µ–π—Å—Ç–≤–∏—è</th>' : ''}</tr></thead>`;
  const tbody = document.createElement('tbody');
  Object.keys(bySub).forEach(sub => {
    const arr = bySub[sub];
    const vals = arr.map(x => parseInt(x.value));
    const avg = (vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(2);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${sub}</td><td>${arr.map(g=>`<span class="grade ${g.value==5?'excellent':g.value==4?'good':g.value==3?'satisfactory':'bad'}">${g.value}</span>`).join(' ')}</td><td>${avg}</td>`;
    if(currentUser && currentUser.type !== 'student'){
      const td = document.createElement('td');
      td.innerHTML = `<button class="btn-action" onclick="editGrade(${arr[0].id})">‚úé</button> <button class="btn-danger" onclick="deleteGrade(${arr[0].id})">üóë</button>`;
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  el.appendChild(table);
}
function saveGradeModal(){
  const sid = parseInt(document.getElementById('mg_student').value);
  const student = diaryData.students.find(s => s.id === sid);
  const subject = document.getElementById('mg_subject').value;
  const value = parseInt(document.getElementById('mg_value').value);
  const date = document.getElementById('mg_date').value;
  if(!student || !subject || !value || !date){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  const did = diaryData.grades.length ? Math.max(...diaryData.grades.map(g=>g.id))+1 : 1;
  diaryData.grades.push({id:did, student:student.name, subject, value, date: formatDateForDisplay(date)});
  saveData(diaryData);
  loadFullAll(); loadLiteAll();
  closeModal('addGradeModal');
}
function editGrade(id){ alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é).'); }
function deleteGrade(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ü–µ–Ω–∫—É?')) return;
  diaryData.grades = diaryData.grades.filter(g => g.id !== id);
  saveData(diaryData);
  loadFullAll(); loadLiteAll();
}

/* ------------------ Students & Teachers ------------------ */
function loadStudentsForFull(){
  const el = document.getElementById('fullStudentsContent');
  el.innerHTML = '';
  if(diaryData.students.length === 0){ el.innerHTML = '<p>–£—á–µ–Ω–∏–∫–æ–≤ –Ω–µ—Ç</p>'; return; }
  const table = document.createElement('table');
  table.innerHTML = `<thead><tr><th>–§–ò–û</th><th>–ö–ª–∞—Å—Å</th><th>–õ–æ–≥–∏–Ω</th>${currentUser && currentUser.type==='admin'?'<th>–î–µ–π—Å—Ç–≤–∏—è</th>':''}</tr></thead>`;
  const tbody = document.createElement('tbody');
  diaryData.students.forEach(s => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.name}</td><td>${s.class}</td><td>${s.login}</td>`;
    if(currentUser && currentUser.type==='admin'){
      const td = document.createElement('td');
      td.innerHTML = `<button class="btn-action" onclick="editStudent(${s.id})">‚úé</button> <button class="btn-danger" onclick="deleteStudent(${s.id})">üóë</button>`;
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  el.appendChild(table);
}
function saveStudentModal(){
  const name = document.getElementById('ms_name').value.trim();
  const cls = document.getElementById('ms_class').value.trim();
  const login = document.getElementById('ms_login').value.trim();
  const pass = document.getElementById('ms_pass').value.trim();
  if(!name||!cls||!login||!pass){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  if(diaryData.users.some(u => u.login === login) || diaryData.students.some(s => s.login === login)){ alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ –µ—Å—Ç—å'); return; }
  const nid = diaryData.students.length ? Math.max(...diaryData.students.map(s=>s.id))+1 : 1;
  diaryData.students.push({id:nid,name, class:cls, login, password: pass});
  const uid = diaryData.users.length ? Math.max(...diaryData.users.map(u=>u.id))+1 : 1;
  diaryData.users.push({id:uid, login, password: pass, type:'student', name, class:cls});
  saveData(diaryData);
  loadFullAll(); loadLiteAll(); closeModal('addStudentModal');
}
function editStudent(id){ alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.'); }
function deleteStudent(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å —É—á–µ–Ω–∏–∫–∞?')) return;
  const s = diaryData.students.find(x=>x.id===id);
  if(s){
    diaryData.students = diaryData.students.filter(x=>x.id!==id);
    diaryData.users = diaryData.users.filter(u=>u.login!==s.login);
    saveData(diaryData);
    loadFullAll(); loadLiteAll();
  }
}

function loadTeachersForFull(){
  const el = document.getElementById('fullTeachersContent');
  el.innerHTML = '';
  if(diaryData.teachers.length === 0){ el.innerHTML = '<p>–£—á–∏—Ç–µ–ª–µ–π –Ω–µ—Ç</p>'; return; }
  const table = document.createElement('table');
  table.innerHTML = `<thead><tr><th>–§–ò–û</th><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–õ–æ–≥–∏–Ω</th>${currentUser && currentUser.type==='admin'?'<th>–î–µ–π—Å—Ç–≤–∏—è</th>':''}</tr></thead>`;
  const tbody = document.createElement('tbody');
  diaryData.teachers.forEach(t => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${t.name}</td><td>${t.subject}</td><td>${t.login}</td>`;
    if(currentUser && currentUser.type==='admin'){
      const td = document.createElement('td');
      td.innerHTML = `<button class="btn-action" onclick="editTeacher(${t.id})">‚úé</button> <button class="btn-danger" onclick="deleteTeacher(${t.id})">üóë</button>`;
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  el.appendChild(table);
}
function saveTeacherModal(){
  const name = document.getElementById('mt_name').value.trim();
  const subject = document.getElementById('mt_subject').value.trim();
  const login = document.getElementById('mt_login').value.trim();
  const pass = document.getElementById('mt_pass').value.trim();
  if(!name||!subject||!login||!pass){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
  if(diaryData.users.some(u => u.login === login) || diaryData.teachers.some(t => t.login === login)){ alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ –µ—Å—Ç—å'); return; }
  const nid = diaryData.teachers.length ? Math.max(...diaryData.teachers.map(t=>t.id))+1 : 1;
  diaryData.teachers.push({id:nid,name,subject,login,password:pass});
  const uid = diaryData.users.length ? Math.max(...diaryData.users.map(u=>u.id))+1 : 1;
  diaryData.users.push({id:uid,login,password:pass,type:'teacher',name,subject});
  saveData(diaryData);
  loadFullAll(); loadLiteAll(); closeModal('addTeacherModal');
}
function editTeacher(id){ alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–∏—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.'); }
function deleteTeacher(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∏—Ç–µ–ª—è?')) return;
  const t = diaryData.teachers.find(x=>x.id===id);
  if(t){
    diaryData.teachers = diaryData.teachers.filter(x=>x.id!==id);
    diaryData.users = diaryData.users.filter(u=>u.login!==t.login);
    saveData(diaryData);
    loadFullAll(); loadLiteAll();
  }
}

/* ------------------ Lite loaders (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä) ------------------ */
function loadLiteAll(){
  // schedule
  const days = { monday:'–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', tuesday:'–í—Ç–æ—Ä–Ω–∏–∫', wednesday:'–°—Ä–µ–¥–∞', thursday:'–ß–µ—Ç–≤–µ—Ä–≥', friday:'–ü—è—Ç–Ω–∏—Ü–∞', saturday:'–°—É–±–±–æ—Ç–∞' };
  const sc = document.getElementById('liteSchedule');
  sc.innerHTML = '';
  Object.keys(days).forEach(dk=>{
    const lessons = diaryData.schedule.filter(s=>s.day===dk);
    if(lessons.length){
      const h = document.createElement('div');
      h.innerHTML = `<div style="font-weight:700">${days[dk]}</div>`;
      lessons.forEach(ls => {
        const p = document.createElement('div');
        p.textContent = `${ls.time} ‚Äî ${ls.subject} (${ls.room}) ‚Äî ${ls.teacher}`;
        h.appendChild(p);
      });
      sc.appendChild(h);
    }
  });

  // homework table
  const hw = document.getElementById('liteHomework'); hw.innerHTML='';
  diaryData.homework.forEach(h=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${h.subject}</td><td>${h.deadline}</td><td>${h.description}</td>`;
    hw.appendChild(tr);
  });

  // grades
  const lg = document.getElementById('liteGrades'); lg.innerHTML='';
  diaryData.grades.forEach(g=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${g.student}</td><td>${g.subject}</td><td>${g.value}</td>`;
    lg.appendChild(tr);
  });

  // students
  const ls = document.getElementById('liteStudentsList'); ls.innerHTML='';
  diaryData.students.forEach(s => {
    const div = document.createElement('div'); div.textContent = `${s.name} ‚Äî ${s.class}`;
    ls.appendChild(div);
  });
  document.getElementById('liteStudentsCount').textContent = diaryData.students.length;

  // teachers
  const lt = document.getElementById('liteTeachersList'); lt.innerHTML='';
  diaryData.teachers.forEach(t => {
    const div = document.createElement('div'); div.textContent = `${t.name} ‚Äî ${t.subject}`;
    lt.appendChild(div);
  });
}

/* ------------------ Full loaders ------------------ */
function loadFullAll(){
  diaryData = getData(); // refresh
  loadScheduleForFull();
  loadHomeworkForFull();
  loadGradesForFull();
  loadStudentsForFull();
  loadTeachersForFull();
  populateGradeStudentsSelect();
}

/* ------------------ Helpers ------------------ */
function openModal(id){ document.getElementById(id).style.display = 'flex'; document.getElementById(id).setAttribute('aria-hidden','false'); }
function closeModal(id){ document.getElementById(id).style.display = 'none'; document.getElementById(id).setAttribute('aria-hidden','true'); 
  // clear editId markers to avoid accidental edits
  if(document.getElementById(id)) document.getElementById(id).dataset.editId = '';
}
function formatDateForDisplay(input){
  // input YYYY-MM-DD -> DD.MM.YYYY ; if already dd.mm.yyyy -> return as is
  if(!input) return '';
  if(input.includes('-')){
    const [y,m,d] = input.split('-'); return `${d}.${m}.${y}`;
  }
  return input;
}

/* ------------------ misc ------------------ */
function populateGradeStudentsSelect(){
  const sel = document.getElementById('mg_student');
  if(!sel) return;
  sel.innerHTML = '';
  diaryData.students.forEach(s => {
    const opt = document.createElement('option'); opt.value = s.id; opt.textContent = s.name; sel.appendChild(opt);
  });
  // set default date to today
  if(document.getElementById('mg_date')) document.getElementById('mg_date').valueAsDate = new Date();
}

/* ------------------ Export (simple) ------------------ */
function exportData(){
  const dataStr = JSON.stringify(diaryData,null,2);
  const blob = new Blob([dataStr], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'diary_data.json'; document.body.appendChild(a);
  a.click(); a.remove(); URL.revokeObjectURL(url);
}

/* ------------------ Startup: auto-suggest lite for 2G and show start ------------------ */
(function startup(){
  // if connection is 2g ‚Äî open start with recommendation already shown (user chooses)
  // otherwise just show start screen
  document.getElementById('startScreen').style.display = 'flex';
  hideAllApps();
})();
</script>
<!-- ================= END: –°–∫—Ä–∏–ø—Ç—ã ================= -->

<!-- Font-awesome icons minimal usage (loaded from CDN) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</body>
</html>
